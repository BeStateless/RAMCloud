Debug logging.

From: Aaron Jones <aaron@vexing.codes>


---
 GNUmakefile       |    4 ++--
 src/DpdkDriver.cc |    5 +++++
 2 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/GNUmakefile b/GNUmakefile
index 7e9dedd6..08f18c73 100644
--- a/GNUmakefile
+++ b/GNUmakefile
@@ -10,7 +10,7 @@
 include $(wildcard private/MakefragPrivateTop)
 
 DEBUG ?= yes
-DEBUG_OPT ?= no
+DEBUG_OPT ?= yes
 YIELD ?= no
 SSE ?= sse4.2
 ARCH ?= native
@@ -58,7 +58,7 @@ ifeq ($(DEBUG),yes)
 ifeq ($(DEBUG_OPT),yes)
 OPTFLAG := -O0
 endif
-DEBUGFLAGS := -DTESTING=1 -fno-builtin
+DEBUGFLAGS := -fno-builtin
 else
 OPTFLAG := -O3
 DEBUGFLAGS := -DNDEBUG
diff --git a/src/DpdkDriver.cc b/src/DpdkDriver.cc
index 012136aa..8c886199 100644
--- a/src/DpdkDriver.cc
+++ b/src/DpdkDriver.cc
@@ -474,14 +474,17 @@ DpdkDriver::release(char *payload)
 void
 DpdkDriver::releaseHint(int maxCount)
 {
+    LOG(WARNING, "STATELESS DEBUG - in releaseHint with maxCount=%i", maxCount);
     while ((maxCount != 0) && !payloadsToRelease.empty()) {
         maxCount--;
         char* payload = payloadsToRelease.back();
         payloadsToRelease.pop_back();
+        LOG(WARNING, "STATELESS DEBUG - releasing payload=%p", payload);
 
         packetBufsUtilized--;
         assert(packetBufsUtilized >= 0);
         if (packet_buf_type(payload) == DPDK_MBUF) {
+            LOG(WARNING, "STATELESS DEBUG - releasing DPDK payload=%p", payload_to_mbuf(payload));
             rte_pktmbuf_free(payload_to_mbuf(payload));
         } else {
             packetBufPool.destroy(reinterpret_cast<PacketBuf*>(
@@ -504,6 +507,7 @@ DpdkDriver::releaseHwPacketBuf(Driver::Received* received)
     // Replace rte_mbuf with our PacketBuf and release it.
     received->sender = packetBuf->sender.get();
     received->payload = packetBuf->payload;
+    LOG(WARNING, "STATELESS DEBUG - releaseHwPacketBuf mbuf=%p", mbuf);
     rte_pktmbuf_free(mbuf);
 }
 
@@ -531,6 +535,7 @@ DpdkDriver::sendPacket(const Address* addr,
     struct rte_mbuf* mbuf = &mockMbuf;
 #else
     struct rte_mbuf* mbuf = rte_pktmbuf_alloc(mbufPool);
+    LOG(WARNING, "STATELESS DEBUG - allocated DPDK buf=%p", mbuf);
 #endif
     if (unlikely(NULL == mbuf)) {
         uint32_t numMbufsAvail = rte_mempool_avail_count(mbufPool);
